{% load config_tags %}
$HTTP["host"] =~ "(^{{ project_url|regexp }}$)" {
    server.document-root = "{{ media_path }}"
    server.follow-symlink = "enable"
    dir-listing.activate = "disable"
{% if project_auth %}
    auth.backend = "plain"
    auth.require = (
    auth.backend.plain.userfile = "/etc/lighttpd/userfiles/{{ project_name }}.userfile"
        "" => (
            "method" => "basic",
            "realm" => "Authentication required",
            "require" => "valid-user",
        )
    )
{% endif %}
    url.rewrite-once = (
        "^{{ media_url|regexp }}(.*)$" => "$1",
        "^/favicon\.ico$" => "/img/favicon.ico",
#        "^(/admin/.*)$" => "", # Uncomment it to disable admin
        "^(/.*)$" => "/fcgi$1",
    )

    alias.url = ({% for url, path in app_media_paths %}
        "{{ url }}" => "{{ path }}"{% endfor %}
    )

    fastcgi.debug = 0
    fastcgi.server = (
        "/fcgi" => (
            "main" => (
                "socket" => "/var/run/lighttpd/{{ project_name }}.socket",
                "check-local" => "disable",
            )
        )
    )
}

{% if project_redirects %}
$HTTP["host"] =~ "{% for redirect in project_redirects %}(^{{ redirect|regexp }}$){% if not forloop.last %}|{% endif %}{% endfor %}" {
     url.redirect = ( "^(/.*)" => "http://{{ project_url }}$1" )
}
{% endif %}